pipeline {
    agent any // Use a Windows node with Visual Studio installed

    environment {
        SOLUTION_FILE = "DotNetFrameworkProject_CE040_CE087/Tour_Management.sln"
        BUILD_CONFIG = "Release"
        MSBUILD_PATH = "C:\\Program Files\\Microsoft Visual Studio\\18\\Enterprise\\MSBuild\\Current\\Bin\\MSBuild.exe"
        PUBLISH_DIR = "C:\\inetpub\\wwwroot\\TourManagement" // IIS deploy path
    }

    stages {
        stage('Checkout') {
            steps {
                git branch: 'main', url: 'https://github.com/kallepallinaveen/Tour_Management_Asp.Net.git'
            }
        }

        stage('Restore NuGet Packages') {
            steps {
                bat '"C:\\Program Files\\NuGet\\nuget.exe" restore %SOLUTION_FILE%'
            }
        }

        stage('Build') {
            steps {
                bat "\"%MSBUILD_PATH%\" %SOLUTION_FILE% /p:Configuration=%BUILD_CONFIG% /t:Build /v:m"
            }
        }

        stage('Test') {
            steps {
                echo "Add unit test execution here if any"
            }
        }

        stage('Deploy') {
            steps {
                echo "Deploying to IIS..."
                bat """
                xcopy /Y /E /I DotNetFrameworkProject_CE040_CE087\\Tour_Management\\bin\\%BUILD_CONFIG%\\* %PUBLISH_DIR%\\bin\\
                xcopy /Y /E /I DotNetFrameworkProject_CE040_CE087\\Tour_Management\\* %PUBLISH_DIR%\\
                """
                echo "Deployment complete"
            }
        }
    }

    post {
        success {
            echo "Build and deployment completed successfully!"
        }
        failure {
            echo "Build failed!"
        }
    }
}
